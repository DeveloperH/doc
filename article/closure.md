## 闭包

所谓闭包，指的是一个拥有许多变量和绑定了这些变量的环境的表达式(通常是一个函数)，因而这些变量也是该表达式的一部分。



闭包的功能:

* 可以访问局部变量
* 使变量所占的内存不被释放

在全局中，不能访问局部变量，因为作用域不同。另外，函数在执行完毕后，局部变量会被回收。

所以，如果想在全局中访问到局部变量，可以使用闭包实现。



```js
function display(){
  var i = 10
}
display()
// 下面代码会报错。在全局中，不能访问局部变量i。
console.log(i)  
```



如何实现闭包呢?

原理: 可以使用一个局部函数包含要访问的局部变量，这样局部变量的内存就不会被回收，然后将该局部函数作为返回值返回，并在全局中声明变量接收该返回值。

```js
// 闭包实现
function f1(){
  var i = 10
  function f2(){
    console.log(i)  // f2函数中包含变量i
  }
  return f2   // 返回f2函数的首地址
}

var test = f1()   // test也指向了f2函数的首地址
test()  // 10
```

解析: 通过作用域链，f2函数可以范围f1函数中的变量i，这时在f2函数中包含了变量i后，在f1函数中返回f2函数。当全局变量test调用f1函数后，test也指向了f2函数的首地址，所以f2函数不会被回收。又因为f2函数中需要用到变量i，所以变量i也不会被回收。执行test函数后，就可以访问到局部变量i了。



![](https://www.huangyihui.cn/upload/gburlimg/531ef39c98756.png)



